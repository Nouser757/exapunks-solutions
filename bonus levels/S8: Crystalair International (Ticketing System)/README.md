# S8: Crystalair International (Ticketing System)
<div align='center'><img src='PB055.gif' /></div>

## Instructions
>ï»¿Each host in the network corresponds to a country and contains a list of tickets for flights (file 200) departing airports in that country, bound for airports either also in that country or in a connected country. Each ticket has the following values: ticket ID, departure airport, departure time, arrival airport, and arrival time.
>
>Book the sequence of flights in deadlock's itinerary (file 300) by deleting each ticket from its file in the network and adding the ticket ID to file 301, choosing the first valid flight that departs after the preceding flight arrives.
>
>Note that deadlock's itinerary will always begin in the USA, and that flight times may be compared with TEST.

## Solution

### [XA](XA.exa) (GLOBAL)
```asm
COPY 25 T
MARK WAIT
SUBI T 1 T
TJMP WAIT
LINK 800
MARK STARTSEARCH
KILL
GRAB 200
COPY M X
COPY M T
REPL HELP
COPY M X
SEEK 1
TEST X = 1
TJMP SKIPTIME
SEEK 1
MARK SEARCHTIME
TEST EOF
TJMP NOTFOUND
TEST F > X
SEEK 4
FJMP SEARCHTIME
TEST EOF
TJMP SKIP2
SEEK -2
MARK SKIP2
SEEK -4
MARK SKIPTIME
COPY M X
MARK SEARCHTICKET
TEST EOF
TJMP NOTFOUND
TEST F = X
SEEK 4
FJMP SEARCHTICKET
TEST EOF
TJMP SKIP1
SEEK -1
MARK SKIP1
SEEK -2
TEST F = M
TJMP FOUND
SEEK 2
JUMP SEARCHTICKET
MARK FOUND
KILL
SEEK -4
MODE
@REP 5
COPY F M
@END
SEEK -5
@REP 5
VOID F
@END
DROP
MODE
REPL GON
REPL GOE
REPL GOS
REPL GOW
JUMP STARTSEARCH

MARK GON
LINK 800
KILL
KILL
JUMP STARTSEARCH

MARK GOE
LINK 801
KILL
KILL
JUMP STARTSEARCH

MARK GOS
LINK 802
KILL
KILL
JUMP STARTSEARCH

MARK GOW
LINK 803
KILL
KILL
JUMP STARTSEARCH

MARK HELP
COPY X M
MARK HLOOP
COPY T M
JUMP HLOOP

MARK NOTFOUND
DROP
KILL
MARK SK
VOID M
JUMP SK
```

### [XB](XB.exa) (GLOBAL)
```asm
COPY 25 T
MARK WAIT
SUBI T 1 T
TJMP WAIT
MARK STARTSEARCH
COPY 0 X
GRAB 301
SEEK 9999
SEEK -1
TEST EOF
TJMP FIRST
COPY F X
MARK FIRSTSKIP
DROP
GRAB 300
@REP 20
NOOP
@END
SEEK -9999
LINK 800 ;US
COPY F M
TEST EOF
TJMP DONE
COPY F M
COPY X M
SEEK -9999
LINK 800 ;CA
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 800 ;IC
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 802
LINK 802
LINK 801 ;FR
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 802 ;SP
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 803 ;PO
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 801
LINK 800
LINK 800 ;UK
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 803 ;IR
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 801
LINK 801 ;SW
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 803
LINK 802
LINK 801 ;GE
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 802 ;IT
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 800
LINK 801 ;PL
COPY F M
COPY F M
COPY X M
SEEK -9999
LINK 803
LINK 803
LINK 803
LINK -1 ;HOME
VOID F
DROP
GRAB 301
MODE
SEEK 9999
@REP 5
COPY M F
@END
DROP
MODE
JUMP STARTSEARCH

MARK FIRST
COPY 1 X
JUMP FIRSTSKIP

MARK DONE
KILL
LINK 800
KILL
LINK 800
KILL
LINK 802
LINK 802
LINK 801
KILL
LINK 802
KILL
LINK 803
KILL
LINK 801
LINK 800
LINK 800
KILL
LINK 803
KILL
LINK 801
LINK 801
KILL
LINK 803
LINK 802
LINK 801
KILL
LINK 802
KILL
LINK 800
LINK 801
KILL
LINK 803
LINK 803
LINK 803
LINK -1
WIPE
GRAB 301
MARK CLEAR
SEEK 1
@REP 4
VOID F
@END
JUMP CLEAR
```

### [SK](SK.exa) (GLOBAL)
```asm
LINK 800 ;US
REPL EAT
LINK 800 ;CA
REPL EAT
LINK 800 ;IC
REPL EAT
LINK 802
LINK 802
LINK 801 ;FR
REPL EAT
LINK 802 ;SP
REPL EAT
LINK 803 ;PO
REPL EAT
LINK 801
LINK 800
LINK 800 ;UK
REPL EAT
LINK 803 ;IR
REPL EAT
LINK 801
LINK 801 ;SW
REPL EAT
LINK 803
LINK 802
LINK 801 ;GE
REPL EAT
LINK 802 ;IT
REPL EAT
LINK 800
LINK 801 ;PL
MARK EAT
VOID M
JUMP EAT
```